rm(list = ls())
dir <- dirname(dirname(rstudioapi::getSourceEditorContext()$path))
setwd(dir)
pacman::p_load(data.table, haven, stargazer, plm, knitr)
# haven: read .dta files
# stargazer: create summary tables
# plm: panel estimation techniques
dt <- as.data.table(read_dta("HW1/GMdata.dta"))
dt[, yrsPresent := .N, by = .(index)] # count how many years the firm appears in the data
dt[, d357 := fifelse(sic3 == 357, 1, 0)] # create an indicator for SIC code equal to 357
# Q1: Summary Statistics ----
stargazer(dt, summary = TRUE, type = "text", omit = c("index", "sic3", "yr"), title  = "Summary Statistics: Full Sample")
stargazer(dt[yrsPresent > 1], summary = TRUE, type = "text", omit = c("index", "sic3", "yr"), title = "Summary Statistics: >1 year firms")
stargazer(dt[yrsPresent == 4], summary = TRUE, type = "text", omit = c("index", "sic3", "yr"), title = "Summary Statistics: Balanced Panel")
table(dt$yr)
table(dt$sic3)
# * Balanced panel ----
plm.olsB <- plm(fmla, data = dt[yrsPresent == 4], model = "pooling", index = c("index", "yr")) # column (1) of Table 3
# Q2: Total, between, within, and random effects estimators ----
fmla <- "ldsal ~ -1 + lemp + ldnpt + ldrst + as.factor(yr)*d357"
# * Full sample ----
plm.ols <- plm(fmla, data = dt, model = "pooling", index = c("index", "yr")) # column (3) of Table 3
plm.with <- plm(fmla, data = dt, model = "within", index = c("index", "yr"), effect = "twoway")
plm.bet <- plm(fmla, data = dt, model = "between", index = c("index", "yr"))
plm.re <- plm(fmla, data = dt, model = "random", index = c("index", "yr"))
stargazer(plm.ols, plm.with, plm.bet, plm.re, type = "text", omit = c("yr", "d357", "index"),
covariate.labels = c("Labor", "Physical Capital", "R&D Capital"),
dep.var.labels = "Log sales",
column.labels = c("Total OLS", "Within","Between", "Random"),
title = "Production Function Parameters: Full Sample")
# * Balanced panel ----
plm.olsB <- plm(fmla, data = dt[yrsPresent == 4], model = "pooling", index = c("index", "yr")) # column (1) of Table 3
plm.withB <- plm(fmla, data = dt[yrsPresent == 4], model = "within", index = c("index", "yr"), effect = "twoway") # column (2) of Table 3
plm.betB <- plm(fmla, data = dt[yrsPresent == 4], model = "between", index = c("index", "yr"))
plm.reB <- plm(fmla, data = dt[yrsPresent == 4], model = "random", index = c("index", "yr"))
stargazer(plm.olsB, plm.withB, plm.betB, plm.reB, type = "text", omit = c("yr", "d357", "index"),
covariate.labels = c("Labor", "Physical Capital", "R&D Capital"),
dep.var.labels = "Log sales",
column.labels = c("Total OLS", "Within","Between", "Random"),
title = "Production Function Parameters: Balanced Panel")
# Q3: Hausman test of RE vs FE ----
# full sample
phtest(plm.with, plm.re) # p-value is significant at 1% --> reject RE model
# balanced panel
phtest(plm.withB, plm.reB) # p-value is insignificant at 5% --> fail to reject RE model
rm(list = ls())
dir <- dirname(dirname(rstudioapi::getSourceEditorContext()$path))
setwd(dir)
pacman::p_load(data.table, haven, stargazer, ggplot2, fixest)
# Question 1: Download airline dataset ----
dt <- as.data.table(read_dta("HW3/airline1997data.dta"))
# NOTE: unique by origin, dest, tkcarrier, T100nonstop
dt[tkcarrier %in% c("AA", "CO", "DL", "NW", "TW", "UA", "US"), carrierType := "Legacy"]
dt[tkcarrier == "WN", carrierType :=  "Southwest"]
dt[is.na(carrierType), carrierType := "Other LCC"]
# * Compute how many markets are served by an origin-carrier pair ----
dt[, nDest := uniqueN(dest), by = .(origin, tkcarrier)]
dt[, outsideShare := totalpassengers / marketsize][, mktShare := totalpassengers / marketsize]
fmla <- "log(mktShare) ~ MdW_oneway_itinfare_ticket + marketdistanceticket + nDest + log(outsideShare)"
utility.ols <- lm(fmla, data = dt)
stargazer(utility.ols, type = "text", omit = c("market"))
View(dt)
View(dt)
rm(list = ls())
dir <- dirname(dirname(rstudioapi::getSourceEditorContext()$path))
setwd(dir)
pacman::p_load(data.table, haven, stargazer, ggplot2, fixest)
# Question 1: Download airline dataset ----
dt <- as.data.table(read_dta("HW3/airline1997data.dta"))
# NOTE: unique by origin, dest, tkcarrier, T100nonstop
dt[tkcarrier %in% c("AA", "CO", "DL", "NW", "TW", "UA", "US"), carrierType := "Legacy"]
dt[tkcarrier == "WN", carrierType :=  "Southwest"]
dt[is.na(carrierType), carrierType := "Other LCC"]
# * Compute how many markets are served by an origin-carrier pair ----
dt[, nDest := uniqueN(dest), by = .(origin, tkcarrier)]
dt[, mktShare := totalpassengers / marketsize]
dt[, outsideShare := 1 - sum(mktShare), by = .(market)]
summary(dt$outsideShare)
View(dt)
fmla <- "log(mktShare) ~ MdW_oneway_itinfare_ticket + marketdistanceticket + nDest + log(outsideShare)"
utility.ols <- lm(fmla, data = dt)
stargazer(utility.ols, type = "text")
utility.ols$residuals
ggplot(data = utility.ols$residuals) +
geom_hist()
as.data.table(utility.ols$residuals)
ggplot(data = as.data.table(utility.ols$residuals),
mapping = aes(x = V1)) +
geom_hist()
ggplot(data = as.data.table(utility.ols$residuals),
mapping = aes(x = V1)) +
geom_histogram()
ggplot(data = as.data.table(utility.ols$residuals), mapping = aes(x = V1)) +
geom_histogram(bins = 60) +
labs(x = "Residual", y = "Frequency")
ggplot(data = as.data.table(utility.ols$residuals), mapping = aes(x = V1)) +
geom_histogram(bins = 90) +
labs(x = "Residual", y = "Frequency")
# Simple OLS ----
fmla <- "log(mktShare) ~ -1 + MdW_oneway_itinfare_ticket + marketdistanceticket + nDest + log(outsideShare)"
utility.ols <- lm(fmla, data = dt)
stargazer(utility.ols, type = "text")
ggplot(data = as.data.table(utility.ols$residuals), mapping = aes(x = V1)) +
geom_histogram(bins = 90) +
labs(x = "Residuals", y = "Frequency")
View(dt)
dt[, nDup := .N, by = .(origin, dest, tkcarrier)]
dt[, nDup > 1]
dt[nDup > 1]
dt[origin == "MCO" & dest == "ABE" & tkcarrier = "US"]
dt[origin == "MCO" & dest == "ABE" & tkcarrier == "US"]
# OLS w/ FEs ----
fmla.fe <- paste0(fmla, " + as.factor(tkcarrier)")
utility.olsfe <- lm(fmla.fe, data = dt)
stargazer(utility.olsfe, type = "text", omit = c("tkcarrier"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"))
?stargazer
fmla.fe
# OLS w/ FEs ----
fmla.fe <- paste0(fmla, " + tkcarrier")
utility.olsfe <- lm(fmla.fe, data = dt)
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"))
stargazer(utility.ols, utility.olsfe, type = "text")
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
omit.labels = TRUE)
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
omit.labels = c("No", "Yes"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
omit.labels = c("Airline FEs"))
# OLS w/ FEs ----
fmla.fe <- paste0(fmla, " + tkcarrier")
utility.olsfe <- lm(fmla.fe, data = dt)
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
omit.labels = c("Airline FEs"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
add.lines = list(c("Airline FEs", "No", "Yes")))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
add.lines = list(c("Airline FEs", "No", "Yes")),
omit.stat = c("F", "R2", "adjR2"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
add.lines = list(c("Airline FEs", "No", "Yes")),
omit.stat = c("F", "R2"))
stargazer(utility.ols, utility.olsfe, type = "text", omit = c("tkcarrier"),
add.lines = list(c("Airline FEs", "No", "Yes")),
omit.stat = c("F"))
ggplot(data = as.data.table(utility.olsfe$residuals), mapping = aes(x = V1)) +
geom_histogram(bins = 90) +
labs(x = "Residuals", y = "Frequency")
# Compute the instruments (BLP 1995, eqn (5.8)) ----
dt[, ownNDest := sum(nDest) - nDest, by = .(market, tkcarrier)]
dt[, rivalNDest := sum(nDest) - (ownNDest + nDest), by = .(market)]
View(dt)
# Compute the instruments (BLP 1995, eqn (5.8)) ----
dt[, rivalNDest := sum(nDest) - nDest, by = .(market)]
# Compute the instruments (BLP 1995, eqn (5.8)) ----
dt[, rivalNDest := sum(nDest) - nDest, by = .(market)]
fmla.fs <- "MdW_oneway_itinfare_ticket ~ -1 + nDest + rivalNDest"
iv.fs <- lm(fmla.fs, data = dt)
dt$p_hat <- predict(iv.fs, dt)
fmla.ss <- "log(mktShare) ~ -1 + p_hat + marketdistanceticket + log(outsideShare)"
iv.ss <- lm(fmla.ss, data = dt)
stargazer(fmla.ss, type = "text")
stargazer(iv.ss, type = "text")
stargazer(utility.ols, iv.ss, type = "text")
ggplot(data = as.data.table(iv.ss$residuals), mapping = aes(x = V1)) +
geom_histogram(bins = 90) +
labs(x = "Residuals", y = "Frequency")
